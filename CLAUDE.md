# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## ğŸ“š å¿«é€Ÿè¨˜æ†¶ç²å–æŒ‡å—

**é‡è¦**: README.md åŒ…å«å®Œæ•´çš„ AI å¿«é€Ÿåƒè€ƒå€å¡Šï¼Œè«‹å„ªå…ˆé–±è®€ä»¥å¿«é€Ÿç²å–å°ˆæ¡ˆè¨˜æ†¶ï¼š

```bash
# é–±è®€å®Œæ•´å°ˆæ¡ˆæ–‡æª”å’Œ AI æ©Ÿå™¨å¯è®€å€å¡Š
Read README.md
# ç‰¹åˆ¥æ³¨æ„ç¬¬ 337-396 è¡Œçš„ YAML æ ¼å¼å¿«é€Ÿåƒè€ƒå€å¡Š
```

è©²å€å¡ŠåŒ…å«ï¼š
- å°ˆæ¡ˆæ¶æ§‹èˆ‡æŠ€è¡“å †ç–Š
- 5é—œéµå­—æœå°‹ç­–ç•¥èˆ‡ AI ç¯©é¸æ©Ÿåˆ¶
- API ç«¯é»èˆ‡ç’°å¢ƒè®Šæ•¸
- Notion å·¥ä½œå€ URL ä¿®æ­£åŠŸèƒ½
- æ„åœ–é¡å‹èˆ‡ä½¿ç”¨é™åˆ¶
- é–‹ç™¼æŒ‡ä»¤èˆ‡éƒ¨ç½²è³‡è¨Š

## ğŸ— å°ˆæ¡ˆæ¶æ§‹æ‘˜è¦

**Notion Chat App** - AI é©…å‹•çš„ç¶²é èŠå¤©æ‡‰ç”¨ç¨‹å¼ï¼Œæ•´åˆ Express + Notion API + Google Gemini AI

### ğŸ”§ æ ¸å¿ƒæŠ€è¡“æ ˆ
- **å‰ç«¯**: åŸç”Ÿ HTML/CSS/JavaScript (å¤§åœ°è‰²ç³»è¨­è¨ˆ)
- **å¾Œç«¯**: Express.js 4.18.2 (Web ä¼ºæœå™¨)
- **AI æœå‹™**: Google Gemini AI (@google/generative-ai)
- **API æ•´åˆ**: Notion Client (@notionhq/client)
- **éƒ¨ç½²**: Render é›²ç«¯å¹³å°

### ğŸ—‚ é—œéµæª”æ¡ˆä½ç½®
```
â”œâ”€â”€ server/index.js              # ä¸» Web ä¼ºæœå™¨ï¼Œè·¯ç”±èˆ‡æ„åœ–åˆ†æ
â”œâ”€â”€ public/                      # éœæ…‹ç¶²é æª”æ¡ˆ
â”‚   â”œâ”€â”€ index.html               # ä¸»ä»‹é¢ (SPA)
â”‚   â”œâ”€â”€ js/app.js                # å‰ç«¯é‚è¼¯
â”‚   â”œâ”€â”€ css/styles.css           # ç·¨è­¯å¾Œæ¨£å¼
â”‚   â””â”€â”€ scss/                    # SCSS åŸå§‹æª”æ¡ˆ
â”œâ”€â”€ services/                    # æ¥­å‹™é‚è¼¯å±¤
â”‚   â”œâ”€â”€ searchService.js         # å¤šè¼ªæœå°‹å¼•æ“ (1-3 è¼ª)
â”‚   â”œâ”€â”€ notionService.js         # Notion API æ•´åˆ
â”‚   â””â”€â”€ geminiService.js         # Gemini AI ç®¡ç† + å¤š Key è¼ªæ›¿
â”œâ”€â”€ routes/                      # API è·¯ç”±æ¨¡çµ„
â”œâ”€â”€ config/                      # æ¨¡çµ„åŒ–é…ç½®ç³»çµ±
â”‚   â”œâ”€â”€ validator.js             # ç’°å¢ƒè®Šæ•¸é©—è­‰ (ntn_ å‰ç¶´æ”¯æ´)
â”‚   â””â”€â”€ intentAnalysis.js        # æ„åœ–åˆ†æé…ç½®
â””â”€â”€ .env                         # ç’°å¢ƒè®Šæ•¸ (NOTION_TOKEN, GEMINI_API_KEY)
```

## ğŸ“¡ è³‡æ–™æµå‘èˆ‡é€šè¨Šæ¶æ§‹

```
ç”¨æˆ¶è¼¸å…¥ â†’ Web å‰ç«¯ â†’ HTTP â†’ server/index.js â†’ /api/chat
                                     â†“
                              analyzeUserIntent()
                                     â†“
                        {greeting|search|chat}
                                     â†“
                  searchService â†’ Notion API + Gemini AI
                                     â†“
                               æ ¼å¼åŒ–å›æ‡‰
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ç³»çµ±

### æ™ºæ…§æ„åœ–åˆ†æ (routes/chat.js)
- **æ”¯æ´é¡å‹**: greetingã€searchã€chat
- **AI é©…å‹•**: ä½¿ç”¨ Gemini åˆ†æç”¨æˆ¶æ„åœ–èˆ‡é—œéµè©
- **é—œéµå­—ç”Ÿæˆ**: æ¯æ¬¡ç”Ÿæˆ5å€‹æœ€é©åˆçš„é—œéµå­—

### å¤šè¼ªæœå°‹å¼•æ“ (services/searchService.js)
- **æœå°‹æ¨¡å¼**: 1-3 è¼ªå¯èª¿ç¯€æœå°‹æ·±åº¦
- **æœå°‹è¦æ¨¡**: 5é—œéµå­— Ã— 100çµæœ = æœ€å¤š500å€‹é é¢
- **ç­–ç•¥**: åŸå§‹5é—œéµå­— â†’ AIå„ªåŒ–é—œéµå­— â†’ AIæ“´å±•é—œéµå­—
- **å»é‡æ©Ÿåˆ¶**: è‡ªå‹•ç”¨ Map çµæ§‹å»é™¤é‡è¤‡é é¢
- **AI ç¯©é¸**: Gemini å¾æ‰€æœ‰çµæœä¸­é¸5å€‹æœ€ç›¸é—œé é¢

### Notion API æ•´åˆ (services/notionService.js)
- **åŠŸèƒ½**: é é¢æœå°‹ã€å…§å®¹æå–ã€éæ­¸è™•ç†
- **é™åˆ¶**: é€Ÿç‡é™åˆ¶ 350msã€æœ€å¤š 10 å€‹çµæœã€æ·±åº¦é™åˆ¶ 3 å±¤
- **æ¬Šé™**: éœ€è¦æ­£ç¢ºçš„ Integration è¨­å®š

### Gemini AI ç®¡ç† (services/geminiService.js)
- **å¤š Key è¼ªæ›¿**: è‡ªå‹•åˆ‡æ› API Key é¿å…é…é¡é™åˆ¶
- **æ¨¡å‹**: gemini-1.5-flash
- **éŒ¯èª¤è™•ç†**: æ™ºæ…§é™ç´šèˆ‡é‡è©¦æ©Ÿåˆ¶

## âš™ï¸ é–‹ç™¼ç’°å¢ƒèˆ‡é…ç½®

### ç’°å¢ƒè®Šæ•¸ (.env)
```bash
# å¿…è¦è¨­å®š
NOTION_TOKEN=ntn_your_token        # æ”¯æ´ ntn_ å‰ç¶´
NOTION_WORKSPACE_ID=workspace-id   # å·¥ä½œå€ IDï¼Œç”¨æ–¼ä¿®æ­£ URL æ ¼å¼
GEMINI_API_KEY=AIzaSy_your_key     # ä¸»è¦ API Key
GEMINI_API_KEY_2=...               # å‚™ç”¨ Key (å¯é¸)
GEMINI_API_KEY_3=...               # å‚™ç”¨ Key (å¯é¸)

# å¯é¸è¨­å®š
PORT=3002                          # å›ºå®šåŸ è™Ÿï¼Œå¯ç”± Render è‡ªå‹•è¨­å®š
HOST=0.0.0.0                      # éƒ¨ç½²æ™‚ä½¿ç”¨
NODE_ENV=production                # ç”Ÿç”¢ç’°å¢ƒ
```

### é–‹ç™¼æŒ‡ä»¤
```bash
npm start       # ç”Ÿç”¢æ¨¡å¼å•Ÿå‹•
npm run dev     # é–‹ç™¼æ¨¡å¼ (åŒ server)
npm run server  # å•Ÿå‹• Express ä¼ºæœå™¨
npm run build:css   # ç·¨è­¯ SCSS æ¨£å¼
npm run watch:css   # ç›£æ§ SCSS è®ŠåŒ–
```

## ğŸ”Œ API æ¶æ§‹

### æ ¸å¿ƒç«¯é» (åŠ ä¸Š /api å‰ç¶´)
- `POST /api/chat` - ä¸»è¦èŠå¤©ä»‹é¢ï¼Œæ”¯æ´ maxRounds åƒæ•¸
- `GET /api/test-notion` - Notion API é€£ç·šæ¸¬è©¦
- `GET /api/health` - ä¼ºæœå™¨å¥åº·æª¢æŸ¥
- `GET /api/api-status` - API Keys ç‹€æ…‹ç›£æ§

### è«‹æ±‚æ ¼å¼
```javascript
// æ¨™æº–èŠå¤©è«‹æ±‚
{
  "message": "æ‰¾ä¸€ä¸‹ JavaScript ç›¸é—œçš„ç­†è¨˜",
  "maxRounds": 2  // æœå°‹è¼ªæ•¸ (1-3)
}
```

### SPA è·¯ç”±è™•ç†
- æ‰€æœ‰é `/api` è·¯ç”±éƒ½è¿”å› `public/index.html`
- æ”¯æ´å‰ç«¯è·¯ç”±å’Œç›´æ¥ URL å­˜å–

## ğŸŒ Render éƒ¨ç½²

### è‡ªå‹•éƒ¨ç½²é…ç½®
- **Repository**: https://github.com/Qoo143/notion-chat-app.git
- **Branch**: master
- **Auto Deploy**: æ˜¯çš„ï¼Œæ¨é€åˆ° master åˆ†æ”¯æœƒè§¸ç™¼è‡ªå‹•éƒ¨ç½²
- **Build Command**: `npm install`
- **Start Command**: `npm start`

### éƒ¨ç½²æµç¨‹
1. **æœ¬åœ°é–‹ç™¼** â†’ æ¸¬è©¦åŠŸèƒ½
2. **Git æäº¤** â†’ `git push origin master`
3. **è‡ªå‹•è§¸ç™¼** â†’ Render æª¢æ¸¬æ¨é€
4. **å»ºç½®éƒ¨ç½²** â†’ åŸ·è¡Œ `npm install` å’Œ `npm start`
5. **æœå‹™ä¸Šç·š** â†’ æ›´æ–°å®Œæˆ

### ç’°å¢ƒè®Šæ•¸ (Render Dashboard)
å¿…é ˆåœ¨ Render è¨­å®šï¼š
- `NOTION_TOKEN`
- `GEMINI_API_KEY`
- `NODE_ENV=production`

## âš ï¸ é‡è¦é™åˆ¶èˆ‡æ³¨æ„äº‹é …

### Notion API é™åˆ¶
- **æœå°‹ç¯„åœ**: åƒ…æ¨™é¡Œæœå°‹ï¼Œç„¡å…§å®¹å…¨æ–‡æœå°‹
- **å–®æ¬¡æœå°‹**: æ¯å€‹é—œéµå­—æœ€å¤š 100 å€‹çµæœ (API å›ºå®šé™åˆ¶)
- **ç¸½æœå°‹é‡**: 5é—œéµå­— Ã— 100 = æœ€å¤š 500 å€‹é é¢
- **é€Ÿç‡é™åˆ¶**: 350ms é–“éš”ï¼Œé¿å… 429 éŒ¯èª¤
- **AI ç¯©é¸**: æœ€çµ‚é¸æ“‡ 5 å€‹æœ€ç›¸é—œé é¢é€²è¡Œå…§å®¹æå–
- **æ¬Šé™è¦æ±‚**: Integration éœ€æ­£ç¢ºåˆ†äº«è‡³ç›®æ¨™é é¢

### æŠ€è¡“æ¶æ§‹é™åˆ¶
- **Web æ‡‰ç”¨**: ç´”ç¶²é æ‡‰ç”¨ï¼Œå·²ç§»é™¤ Electron æ¶æ§‹
- **å¤šç”¨æˆ¶è¨­è¨ˆ**: æ”¯æ´å¤šç”¨æˆ¶åŒæ™‚ä½¿ç”¨
- **åŒæ­¥è™•ç†**: ç„¡ä¸¦è¡Œè«‹æ±‚æ”¯æ´
- **é›²ç«¯éƒ¨ç½²**: é‹è¡Œæ–¼ Render å¹³å°

### ç’°å¢ƒä¾è³´
- **Node.js**: >= 18.0.0
- **ç¶²è·¯é€£ç·š**: ä¾è³´å¤–éƒ¨ API (Notion + Gemini)
- **API é…é¡**: Gemini AI æœ‰æ¯æ—¥é™åˆ¶
- **éƒ¨ç½²å¹³å°**: ä¾è³´ Render é›²ç«¯æœå‹™

## ğŸ›  å¸¸è¦‹é–‹ç™¼ä»»å‹™

### æ–°å¢ API ç«¯é»
åœ¨ `routes/` ç›®éŒ„ä¸­æ–°å¢è·¯ç”±æ¨¡çµ„ï¼Œä½¿ç”¨ `asyncHandler` åŒ…è£

### ä¿®æ”¹æœå°‹é‚è¼¯
ç·¨è¼¯ `services/searchService.js`ï¼Œèª¿æ•´ `performDynamicSearch` å‡½å¼

### èª¿æ•´æ„åœ–åˆ†æ
ä¿®æ”¹ `config/intentAnalysis.js` é—œéµè©æˆ–è·¯ç”±ä¸­çš„ `analyzeUserIntent`

### æ›´æ–° UI ä»‹é¢
ç·¨è¼¯ `public/` ä¸‹çš„ HTML/CSS/JS æª”æ¡ˆ

### æ¨£å¼é–‹ç™¼
1. ç·¨è¼¯ `public/scss/` ä¸‹çš„ SCSS æª”æ¡ˆ
2. ä½¿ç”¨ `npm run watch:css` ç›£æ§è®ŠåŒ–
3. ç·¨è­¯å¾Œçš„ CSS æœƒè¼¸å‡ºåˆ° `public/css/`

### æ–°å¢é…ç½®é¸é …
åœ¨ `config/` ç›®éŒ„å»ºç«‹æ¨¡çµ„ï¼Œä¸¦é©ç•¶åŒ¯å‡º

## ğŸ” é™¤éŒ¯èˆ‡æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ
1. **éƒ¨ç½²å¤±æ•—**: æª¢æŸ¥ç’°å¢ƒè®Šæ•¸æ˜¯å¦æ­£ç¢ºè¨­å®š
2. **API Token ç„¡æ•ˆ**: æª¢æŸ¥ .env æª”æ¡ˆä¸­çš„ token æ ¼å¼èˆ‡æ¬Šé™
3. **æœå°‹ç„¡çµæœ**: ç¢ºèª Notion Integration å·²æ­£ç¢ºåˆ†äº«è‡³ç›®æ¨™é é¢
4. **CSS æ¨£å¼å•é¡Œ**: ç¢ºä¿ SCSS å·²æ­£ç¢ºç·¨è­¯

### æ—¥èªŒæª¢æŸ¥
- **æœ¬åœ°é–‹ç™¼**: åœ¨ `npm run dev` çš„çµ‚ç«¯ä¸­æŸ¥çœ‹
- **Render éƒ¨ç½²**: åœ¨ Render Dashboard çš„ Logs é é¢æŸ¥çœ‹
- **å‰ç«¯é™¤éŒ¯**: ä½¿ç”¨ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·

### é…ç½®é©—è­‰
å•Ÿå‹•æ™‚æœƒè‡ªå‹•é©—è­‰ç’°å¢ƒè®Šæ•¸ï¼Œå¤±æ•—æœƒé¡¯ç¤ºå…·é«”éŒ¯èª¤ä¿¡æ¯

## ğŸš€ éƒ¨ç½²æº–å‚™

### æœ¬åœ°é–‹ç™¼æª¢æŸ¥æ¸…å–®
- [ ] Node.js >= 18.0.0
- [ ] åŸ è™Ÿ 3002 å¯ç”¨ (å¯èª¿æ•´)
- [ ] Notion Integration Token æœ‰æ•ˆ (ntn_ å‰ç¶´)
- [ ] Gemini API Key æœ‰æ•ˆ (AIzaSy å‰ç¶´)
- [ ] ç¶²è·¯é€£ç·šç©©å®š
- [ ] Notion å·¥ä½œå€æ¬Šé™æ­£ç¢º

### Render éƒ¨ç½²æª¢æŸ¥æ¸…å–®
- [ ] GitHub Repository å·²é€£çµ
- [ ] ç’°å¢ƒè®Šæ•¸å·²åœ¨ Render Dashboard è¨­å®š
- [ ] Auto Deploy å·²å•Ÿç”¨
- [ ] Build å’Œ Start å‘½ä»¤æ­£ç¢º
- [ ] æœå‹™åŸŸåå·²è¨­å®š

### éƒ¨ç½²æ¸¬è©¦
1. **æœ¬åœ°æ¸¬è©¦**: `npm start` ç¢ºä¿åŠŸèƒ½æ­£å¸¸
2. **æ¨é€ä»£ç¢¼**: `git push origin master`
3. **ç›£æ§éƒ¨ç½²**: åœ¨ Render Dashboard æŸ¥çœ‹éƒ¨ç½²ç‹€æ…‹
4. **é©—è­‰æœå‹™**: ç¢ºèªéƒ¨ç½²çš„ç¶²ç«™åŠŸèƒ½æ­£å¸¸
5. **API æ¸¬è©¦**: æ¸¬è©¦ `/api/health` å’Œ `/api/test-notion`

---

**æœ€å¾Œæ›´æ–°**: 2025-09-13
**ç‰ˆæœ¬**: 2.0.0 (Web Application)
**ç‹€æ…‹**: å·²éƒ¨ç½²è‡³ Renderï¼Œæ”¯æ´è‡ªå‹•éƒ¨ç½²æ›´æ–°

## ğŸ”„ è‡ªå‹•éƒ¨ç½²ç¢ºèª

**æ˜¯çš„ï¼Œä½ çš„å°ˆæ¡ˆæ”¯æ´è‡ªå‹•éƒ¨ç½²ï¼**

ç•¶ä½ åŸ·è¡Œ `git push origin master` æ¨é€æ›´æ–°åˆ° GitHub æ™‚ï¼š
1. Render æœƒè‡ªå‹•æª¢æ¸¬åˆ° master åˆ†æ”¯çš„è®Šæ›´
2. è§¸ç™¼æ–°çš„éƒ¨ç½²æµç¨‹
3. åŸ·è¡Œ `npm install` å®‰è£ä¾è³´
4. åŸ·è¡Œ `npm start` å•Ÿå‹•æœå‹™
5. éƒ¨ç½²å®Œæˆå¾Œæ›´æ–°ç·šä¸Šæœå‹™

ä½ å¯ä»¥åœ¨ Render Dashboard ç›£æ§æ•´å€‹éƒ¨ç½²éç¨‹å’Œç‹€æ…‹ã€‚